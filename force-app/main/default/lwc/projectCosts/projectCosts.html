<template>

<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> SPINNER <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->
    <template if:true={isComponentLoading} >
        <div style="height: 80px; position: relative;" >
            <lightning-spinner alternative-text="Loading"
                               size="medium"
                               variant="brand" >
            </lightning-spinner>
        </div>
    </template>


    <template if:true={isCostsListNotEmpty}>

<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> COMPONENT HEADER <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->
        <div class="slds-m-around_x-small" style="text-align: right;">
            <lightning-button-group>
                <lightning-button label={collapseExpandAllButtonLabel}
                                  title="Collapse Expand All"
                                  onclick={onCollapseExpandAllHandler} >
                </lightning-button>
                <lightning-button label="Project Costs (PDF)"
                                  title="Project Costs (PDF)"
                                  onclick={onProjectCostsPDFHandler}
                                  variant="brand">
                </lightning-button>
                <lightning-button-menu alternative-text="Export Options"
                                       menu-alignment="right"
                                       variant="border-filled"
                                       onselect={onExportOptionsChange}>
                    <template for:each={exportOptionsMenu} for:item="menuItem" >
                        <lightning-menu-item key={menuItem.value}
                                             label={menuItem.label}
                                             value={menuItem.value}
                                             checked={menuItem.active}>
                        </lightning-menu-item>
                    </template>
                </lightning-button-menu>
            </lightning-button-group>
        </div>

<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> COMPONENT BODY <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->
        <lightning-accordion allow-multiple-sections-open="true" 
                             for:index="index"
                             class="project-costs"
                             onsectiontoggle={onSectionToggleHandler}
                             active-section-name={summarySectionName}>
            <lightning-accordion-section name={summarySectionName}
                                         label={summarySectionName} >
                <c-project-cost-summary project-id={recordId} >
                </c-project-cost-summary>
            </lightning-accordion-section>
            <template for:each={costs} for:item="cost" >
                <lightning-accordion-section key={index} 
                                             name={cost.section}
                                             label={cost.sectionLabel} >
                    <lightning-datatable key-field="id"
                                         aria-label={cost.section}
                                         columns={columns}
                                         data={cost.data}
                                         hide-checkbox-column="true"
                                         resize-column-disabled="true"
                                         default-sort-direction={defaultSortDirection}
                                         sorted-direction={cost.sortDirection}
                                         sorted-by={cost.sortedBy}
                                         onsort={onSortHandler} >
                    </lightning-datatable>
                    <div class="slds-grid slds-gutters" >
                        <div class="slds-col">
                            <lightning-button label="Collapse"
                                              title="Collapse Section"
                                              aria-label={cost.section}
                                              onclick={onCollapseSectionHandler}
                                              variant="base"
                                              class="slds-m-left_x-small">
                            </lightning-button>
                        </div>
                        <div class="slds-col" style="margin: 10px; text-align: right;">
                            <lightning-formatted-number value={cost.subtotal}
                                                        format-style="currency"
                                                        currency-code="USD"
                                                        style="font-weight: bold;">
                            </lightning-formatted-number>
                        </div>
                    </div>
                </lightning-accordion-section>
            </template>
        </lightning-accordion>

<!-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> COMPONENT FOOTER <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< -->
        <div class="slds-m-around_x-small" style="text-align: right;">
            <lightning-button-group>
                <lightning-button label={collapseExpandAllButtonLabel}
                                  title="Collapse Expand All"
                                  onclick={onCollapseExpandAllHandler} >
                </lightning-button>
                <lightning-button label="Project Costs (PDF)"
                                  title="Project Costs (PDF)"
                                  onclick={onProjectCostsPDFHandler}
                                  variant="brand">
                </lightning-button>
                <lightning-button-menu alternative-text="Export Options"
                                       menu-alignment="right"
                                       variant="border-filled"
                                       onselect={onExportOptionsChange}>
                    <template for:each={exportOptionsMenu} for:item="menuItem" >
                        <lightning-menu-item key={menuItem.value}
                                             label={menuItem.label}
                                             value={menuItem.value}
                                             checked={menuItem.active}>
                        </lightning-menu-item>
                    </template>
                </lightning-button-menu>
            </lightning-button-group>
        </div>

        
    </template>
</template>